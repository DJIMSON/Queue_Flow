
# √Ä AJOUTER dans run.py apr√®s la cr√©ation de la base de donn√©es

# Cr√©er les utilisateurs par d√©faut (Admin + Op√©rateurs pour chaque institution)
def create_default_users():
    from crud_users import create_user
    from schemas import UserCreate

    db = SessionLocal()

    try:
        # V√©rifier si l'admin existe d√©j√†
        existing_admin = db.query(User).filter(User.email == 'admin@queueflow.sn').first()
        if existing_admin:
            print('‚úÖ Admin existe d√©j√†')
        else:
            # Cr√©er l'admin
            admin_data = UserCreate(
                email='admin@queueflow.sn',
                password='admin123',
                name='Admin QueueFlow',
                role='admin',
                institution_id=None
            )
            create_user(db, admin_data)
            print('‚úÖ Admin cr√©√©')

        # Liste des 12 institutions avec leurs IDs
        institutions = [
            (1, 'H√¥pital Aristide Le Dantec', 'operator@ledantec.sn'),
            (2, 'H√¥pital Principal de Dakar', 'operator@principal.sn'),
            (3, 'H√¥pital Fann', 'operator@fann.sn'),
            (4, 'H√¥pital Abass Ndao', 'operator@abassndao.sn'),
            (5, 'Clinique Cheikh Zaid', 'operator@cheikh.sn'),
            (6, 'Mairie Plateau', 'operator@plateau.sn'),
            (7, 'Mairie Medina', 'operator@medina.sn'),
            (8, 'Mairie Parcelles Assainies', 'operator@parcelles.sn'),
            (9, 'Banque BICIS', 'operator@bicis.sn'),
            (10, 'SGBS Soci√©t√© G√©n√©rale', 'operator@sgbs.sn'),
            (11, 'BOA S√©n√©gal', 'operator@boa.sn'),
            (12, 'Centre DAKAR-BUS', 'operator@dakarbus.sn'),
        ]

        # Cr√©er un op√©rateur pour chaque institution
        for inst_id, inst_name, email in institutions:
            existing = db.query(User).filter(User.email == email).first()
            if existing:
                print(f'‚úÖ Op√©rateur {inst_name} existe d√©j√†')
            else:
                operator_data = UserCreate(
                    email=email,
                    password='operator123',
                    name=f'Op√©rateur {inst_name}',
                    role='operator',
                    institution_id=inst_id
                )
                create_user(db, operator_data)
                print(f'‚úÖ Op√©rateur cr√©√© pour {inst_name}')

        print('\n' + '='*60)
        print('üéâ TOUS LES UTILISATEURS PAR D√âFAUT CR√â√âS !')
        print('='*60)

    except Exception as e:
        print(f'‚ùå Erreur cr√©ation utilisateurs: {e}')
    finally:
        db.close()
